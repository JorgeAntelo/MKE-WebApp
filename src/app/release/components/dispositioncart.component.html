<div class="row">
    <div class="col-md-6 col-xs-12">
        <div> &nbsp;&nbsp;<h4>&nbsp;&nbsp;Cashiering </h4>
        </div>
    </div>
    <div class="col-md-6 col-xs-12 martop20 text-right">
        <button mat-button color="primary" class="btn btn-blue1" title="Clear All Data"
            style="height: 3rem;margin-right: 1.3em;" (click)="clearCashiering()">
            <i class="fa fa-eraser" aria-hidden="true"></i>&nbsp; Reset
        </button>
    </div>
</div>

<div class="row" id="Top">
    <div class="col-md-12 col-xs-12">
        <div *ngIf="ErrorMsg" role="alert" class="alert alert-danger alert-dismissible">
            &nbsp;&nbsp;<span class="glyphicon glyphicon-warning-sign" aria-hidden="true"></span>
            <span class="sr-only">Error:</span>
            {{ErrorMsg}}
        </div>
        <div *ngIf="SuccessMsg" role="alert" class="alert alert-success alert-dismissible">
            &nbsp;&nbsp;<span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
            {{SuccessMsg}}
        </div>
    </div>
    <div class="col-md-12">
        <div class="alert alert-info" role="alert" *ngIf="indLoading">
            &nbsp;&nbsp;<img src="{{LoaderImage}}" width="32" height="32" /> Loading...</div>
    </div>
</div>

<!-- Citations -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyCitations')">
                <span class="pull-right">
                    <i [ngClass]="bodyCitations ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span>
                <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Citations
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyCitations === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12" style="margin-bottom: 2rem;">
                    <form [formGroup]="CitationForm">
                        <div class="form-group col-md-2 col-xs-12">
                            <label for="ddlsearchType">Search Type<span class="required">*</span></label>
                            <select id="ddlsearchType" name="ddlsearchType" class="form-control" style="margin-left: 0;"
                                formControlName="searchTypeFormControl" (change)="onSearchType($event)">
                                <option value="">--Select--</option>
                                <option value="C">Citation</option>
                                <option value="N">Name</option>
                                <option value="P">Lic Plate</option>
                                <option value="V">VIN</option>
                            </select>
                        </div>
                        <div *ngIf="cf.searchTypeFormControl.value == 'P'">
                            <div class="form-group col-md-3 col-xs-12">
                                <label for="ticketLicensePlate">License Plate<span class="required">*</span></label>
                                <input type="text" class="form-control" id="ticketLicensePlate"
                                    formControlName="licensePlateFormControl"
                                    [ngClass]="{ 'is-invalid': submitted && cf.licensePlateFormControl.errors }">
                                <div *ngIf="submitted && cf.licensePlateFormControl.errors" class="invalid-feedback">
                                    <div *ngIf="cf.licensePlateFormControl.errors.required">Required Field</div>
                                </div>
                            </div>
                            <div class="form-group col-md-3 col-xs-12">
                                <label for=" ticketState">State</label>
                                <input type="text" class="form-control" id="ticketState"
                                    formControlName="stateFormControl">
                            </div>
                        </div>
                        <div class="form-group col-md-3 col-xs-12" *ngIf="cf.searchTypeFormControl.value == 'C'">
                            <label for=" CitationNo">Citation #:<span class="required">*</span></label>
                            <input type="text" class="form-control" id="CitationNo"
                                formControlName="citationNoFormControl"
                                [ngClass]="{ 'is-invalid': submitted && cf.citationNoFormControl.errors }">
                            <div *ngIf="submitted && cf.citationNoFormControl.errors" class="invalid-feedback">
                                <div *ngIf="cf.citationNoFormControl.errors.required">Required Field</div>
                            </div>
                        </div>
                        <div class="form-group col-md-3 col-xs-12" *ngIf="cf.searchTypeFormControl.value == 'V'">
                            <label for=" CitationNo">VIN #:<span class="required">*</span></label>
                            <input type="text" class="form-control" id="CitationNo"
                                formControlName="vinNoFormControl"
                                [ngClass]="{ 'is-invalid': submitted && cf.vinNoFormControl.errors }">
                            <div *ngIf="submitted && cf.vinNoFormControl.errors" class="invalid-feedback">
                                <div *ngIf="cf.vinNoFormControl.errors.required">Required Field</div>
                            </div>
                        </div>
                        <div *ngIf="cf.searchTypeFormControl.value == 'N'">
                            <div class="form-group col-md-3 col-xs-12">
                                <label for=" firstName">First Name<span class="required">*</span></label>
                                <input type="text" class="form-control" id="firstName"
                                    formControlName="firstNameFormControl"
                                    [ngClass]="{ 'is-invalid': submitted && cf.firstNameFormControl.errors }">
                                <div *ngIf="submitted && cf.firstNameFormControl.errors" class="invalid-feedback">
                                    <div *ngIf="cf.firstNameFormControl.errors.required">Required Field</div>
                                </div>
                            </div>
                            <div class="form-group col-md-3 col-xs-12">
                                <label for=" lastName">Last Name<span class="required">*</span></label>
                                <input type="text" class="form-control" id="lastName"
                                    formControlName="lastNameFormControl"
                                    [ngClass]="{ 'is-invalid': submitted && cf.lastNameFormControl.errors }">
                                <div *ngIf="submitted && cf.lastNameFormControl.errors" class="invalid-feedback">
                                    <div *ngIf="cf.lastNameFormControl.errors.required">Required Field</div>
                                </div>
                            </div>
                        </div>
                        <div class="form-group col-md-3 col-xs-12">
                            <br>
                            <button mat-button color="primary" class="btn btn-blue1 btn-labeled"
                                (click)="searchCitations()" style="height: 3rem;margin-top: .5rem;">
                                <i class="fa fa-search" aria-hidden="true">&nbsp;
                                </i>Search
                            </button>
                        </div>

                    </form>
                </div>
                <div class="clearfix"></div>
                <div class="col-md-12 col-xs-12">
                    <app-citations [cartScreenData]="citationSearchData" [userId]='UserId'
                        [parentScreenName]='ParentScreen' [vehicleStatus]='VehicleStatus'></app-citations>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- DMV -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyDMV')">
                <!-- -->
                <span class="pull-right">
                    <i [ngClass]="bodyDMV ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span><i class="fa fa-bars" aria-hidden="true"></i>&nbsp;DMV
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyDMV === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12">
                    <app-dmv [userId]='UserId' [parentScreenName]='ParentScreen' [vehicleStatus]='VehicleStatus'>
                    </app-dmv>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Permits -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyPermits')">
                <!-- -->
                <span class="pull-right">
                    <i [ngClass]="bodyPermits ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span>
                <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Permits
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyPermits === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12">
                    <app-permit [userId]='UserId' [parentScreenName]='ParentScreen' [vehicleStatus]='VehicleStatus'>
                    </app-permit>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment Plan -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyPaymentPlan')">
                <span class="pull-right">
                    <i [ngClass]="bodyPaymentPlan ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span>
                <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Fleet Payments
                <!-- Payment Plan -->
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyPaymentPlan === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12">
                    <app-payment-plan [userId]='UserId' [parentScreenName]='ParentScreen' [vehicleStatus]='VehicleStatus'>
                    </app-payment-plan>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Misc Items -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyAdditionalPayment')">
                <span class="pull-right">
                    <i [ngClass]="bodyAdditionalPayment ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span><i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Misc Items
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyAdditionalPayment === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12">
                    <app-additionalpayment [userId]='UserId' [parentScreenName]='ParentScreen'
                        [vehicleStatus]='VehicleStatus'>
                    </app-additionalpayment>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyPayment')">
                <span class="pull-right">
                    <i [ngClass]="bodyPayment ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span>
                <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Payment
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyPayment === true ? 'block' : 'none' }">
                <div class="col-md-9 col-xs-12">
                    <app-payment [userId]='UserId' [parentScreenName]='ParentScreen' [vehicleStatus]='VehicleStatus'
                        [ReleaseToInsurance]='SelectReleaseToInsurance' [IsCloverRadioButtonEnable]='IsCloverRadioButtonEnable'  [IsOnlinePaid]="IsOnlinePaid"></app-payment>
                </div>
                <div class="col-md-3 col-xs-12">
                    <ng-container *ngTemplateOutlet="templatePaymentSummary"></ng-container>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Refund -->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyRefund')">
                <!-- -->
                <span class="pull-right">
                    <i [ngClass]="bodyRefund ? 'fa fa-chevron-up' : 'fa fa-chevron-down'" aria-hidden="true"
                        style="cursor: pointer;"></i>
                </span>
                <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Refund
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyRefund === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12">
                    <app-refund [userId]='UserId'></app-refund>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Update Payment Transaction-->
<div class="row">
    <div class="col-md-12 col-xs-12 padd15">
        <div class="panel panel-default">
            <div class="panel-heading" (click)="toggle('bodyUpdatePaymentTransaction')">
                <span class="pull-right">
                    <i [ngClass]="bodyUpdatePaymentTransaction ? 'fa fa-chevron-up' : 'fa fa-chevron-down'"
                        aria-hidden="true" style="cursor: pointer;"></i>
                </span>
                <i class="fa fa-bars" aria-hidden="true"></i>&nbsp;Receipt
            </div>
            <div class="panel-body" [ngStyle]="{'display': bodyUpdatePaymentTransaction === true ? 'block' : 'none' }">
                <div class="col-md-12 col-xs-12">
                    <app-update-payment [userId]='UserId'></app-update-payment>
                </div>
            </div>
        </div>
    </div>
</div>
<input type="hidden" id="userId" />

<ng-template #templatePaymentSummary>
    <div class="panel panel-default">
        <div class="panel-heading">Summary</div>
        <div class="panel-body">
            <ul>
                <li>
                    <span class="text-style">Total of Citations:</span>
                    <span class="pull-right">{{totalofCitations | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Total of Permits:</span>
                    <span class="pull-right">{{totalofPermits | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Total of Fleet Payment:</span>
                    <span class="pull-right">{{totalofPaymentPlan | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Total of DMV:</span>
                    <span class="pull-right">{{totalofDMV | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Total of Other Fees:</span>
                    <span class="pull-right">{{totalofAP | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Total Amount:</span>
                    <span
                        class="pull-right">{{(totalofCitations + totalofPermits + totalofDMV + totalofAP + totalofPaymentPlan)| currency}}</span>
                </li>
                <hr>
                <li style="font-size: 1.8rem;">
                    <span class="text-style">Payment Due:</span>
                    <span class="pull-right required">{{PaymentDue | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Change Amount:</span>
                    <span class="pull-right">{{ChangeAmt | currency}}</span>
                </li>
                <hr>
                <li>
                    <span class="text-style">Receipt #:</span>
                    <span class="pull-right">{{ReceiptNo}}</span>
                </li>
            </ul>
            <!-- <div class="clearfix"></div>
            <button mat-button color="primary" class="btn btn-blue1 btn-labeled"
                style="height: 3rem;width: -webkit-fill-available;" (click)="Pay('No', 'Permits')">
                Pay &nbsp;<i class="fa fa-money" aria-hidden="true"></i>
            </button> -->
        </div>
    </div>
</ng-template>

<ng-template #templateDocumentViewer class="gray modal-lg" style="width: 100% !important;">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title pull-left">Document Viewer</h3>
            <button type="button" class="close pull-right" aria-label="Close"
                (click)="modaltemplateDocumentViewerRef.hide()" title="Close">
                <i class="fa fa-times-circle" aria-hidden="true"></i>
            </button>
        </div>
        <div class="modal-body">
            <iframe [src]="documentUrl" style="width: 100%; height:460px; margin-left: 5px; border: 1px solid #ccc;"
                frameborder="1"></iframe>
        </div>
    </div>
</ng-template>
<!-- <script type="text/javascript" src="https://ddocs.govtow.com/twain/resources/dynamsoft.webtwain.install.js"></script>
  <script type="text/javascript" src="https://ddocs.govtow.com/twain/resources/dynamsoft.webtwain.initiate.js"></script>
  <script type="text/javascript" src="https://ddocs.govtow.com/twain/resources/dynamsoft.webtwain.config.js"></script>
  
<script type="text/javascript">
    var DWObject;

    Dynamsoft.WebTwainEnv.RegisterEvent('OnWebTwainReady', Dynamsoft_OnReady); // Register OnWebTwainReady event. This event fires as soon as Dynamic Web TWAIN is initialized and ready to be used
    function Dynamsoft_OnReady() {
        DWObject = Dynamsoft.WebTwainEnv.GetWebTwain('dwtcontrolContainer'); // Get the Dynamic Web TWAIN object that is embeded in the div with id 'dwtcontrolContainer'
        if (DWObject) {
            var count = DWObject.SourceCount;
            for (var i = 0; i < count; i++) {
                document.getElementById("source").options.add(new Option(DWObject.GetSourceNameItems(i), i));
            }
        }
    }
</script> -->
